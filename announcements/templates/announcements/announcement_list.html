<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    {% load static %}
    <title>Sustainable Campus</title>
    <link rel="stylesheet" href="/static/css/announcement_list.css" />
    <link rel="stylesheet" href="{% static 'css/navbar.css' %}" />
    <link href="https://cdn.lineicons.com/5.0/lineicons.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="{% static '/bootstrap/css/bootstrap.min.css' %}"
    />
    <style>
        .card {
            cursor: pointer;
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .modal-img {
            max-height: 400px;
            object-fit: cover;
        }
        .full-content {
            display: none; 
        }
    </style>
  </head>

  <body>
    {% include 'navbar.html' %}  

    <div class="container py-5">

      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0">Announcements</h1> 
        <a href="{% url 'create_announcement' %}" class="btn btn-outline-success p-2 lh-1 d-flex align-items-center">Create New Announcement</a>
      </div>

      <div class="row g-4">
        {% for announcement in announcements %}
          <div class="col-12 col-md-6 col-lg-4">
            <div class="card h-100 shadow">
              <img
                src="{{ announcement.image.url }}"
                class="card-img-top"
                style="height: 200px; object-fit: cover;"
                alt="{{ announcement.title }}"
              />
              <div class="card-body">
                <h5 class="card-title">{{ announcement.title }}</h5>
                <p class="card-text">
                  {{ announcement.summary }} 
                </p> 
                <small class="text-muted meta-data">
                  Author: {{ announcement.author }} | Role: {{ announcement.author.role }} | Date: {{ announcement.created_at }}
                </small>
                <div class="full-content">
                  {{ announcement.content }}
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div> 

    <!-- Announcement Modal -->
    <div class="modal fade" id="announcementModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalTitle"></h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <img
              src=""
              class="modal-img img-fluid mb-3 w-100"
              id="modalImage"
            />
            <p id="modalContent"></p>
        </div>
        <div class="modal-footer justify-content-between">
            <small class="text-muted" id="modalMetaData"></small>
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="{% static '/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const cards = document.querySelectorAll(".card");
        const modal = new bootstrap.Modal(
          document.getElementById("announcementModal")
        );

        cards.forEach((card) => {
          card.addEventListener("click", () => {
            // Extract data from card elements
            const title = card.querySelector(".card-title").textContent;
            const content = card.querySelector(".full-content").textContent;
            const meta_data = card.querySelector(".meta-data").textContent;
            const image = card.querySelector("img").src;

            // Update modal content
            document.getElementById("modalTitle").textContent = title;
            document.getElementById("modalContent").textContent = content;
            document.getElementById("modalMetaData").textContent = meta_data;
            document.getElementById("modalImage").src = image;

            // Show modal
            modal.show();
          });
        });
      });
    </script>
  </body>
</html>
